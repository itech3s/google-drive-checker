<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Account Google Drive Checker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .header h1 {
            color: #4285f4;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #4285f4;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .setup-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #4285f4;
        }
        
        .method-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            transition: all 0.3s;
        }
        
        .method-card:hover {
            border-color: #4285f4;
            transform: translateY(-2px);
        }
        
        .method-card h3 {
            color: #4285f4;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }
        
        .pros, .cons {
            padding: 15px;
            border-radius: 8px;
        }
        
        .pros {
            background: #d4f4dd;
            border-left: 4px solid #34a853;
        }
        
        .cons {
            background: #fce8e6;
            border-left: 4px solid #ea4335;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4285f4;
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #4285f4, #34a853);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ea4335, #d93025);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #34a853, #137333);
        }
        
        .account-manager {
            display: grid;
            gap: 20px;
            margin: 20px 0;
        }
        
        .account-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
        }
        
        .account-item.connected {
            border-color: #34a853;
            background: linear-gradient(135deg, #f0f8f0, #e8f5e8);
        }
        
        .account-item.disconnected {
            border-color: #ea4335;
            background: linear-gradient(135deg, #fef5f5, #fce8e6);
        }
        
        .account-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .account-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .account-details {
            flex-grow: 1;
        }
        
        .account-email {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }
        
        .account-status {
            font-size: 14px;
            color: #666;
        }
        
        .account-actions {
            display: flex;
            gap: 10px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .storage-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
        }
        
        .storage-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .card-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }
        
        .card-info h3 {
            color: #4285f4;
            margin-bottom: 5px;
        }
        
        .card-info p {
            color: #666;
            font-size: 14px;
        }
        
        .storage-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .storage-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .storage-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .storage-value {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #34a853, #fbbc04, #ea4335);
            transition: width 0.3s ease;
        }
        
        .plan-badge {
            display: inline-block;
            background: linear-gradient(135deg, #4285f4, #34a853);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .error {
            background: #fce8e6;
            color: #d93025;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 16px;
        }
        
        .summary-stats {
            background: linear-gradient(135deg, #4285f4, #34a853);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .pros-cons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Multi-Account Google Drive Checker</h1>
            <p>Qu·∫£n l√Ω v√† ki·ªÉm tra nhi·ªÅu t√†i kho·∫£n Google Drive c√πng l√∫c</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('overview')">üìä T·ªïng quan</div>
            <div class="tab" onclick="switchTab('setup')">‚öôÔ∏è Thi·∫øt l·∫≠p</div>
            <div class="tab" onclick="switchTab('accounts')">üë• Qu·∫£n l√Ω t√†i kho·∫£n</div>
            <div class="tab" onclick="switchTab('results')">üìà K·∫øt qu·∫£</div>
        </div>

        <!-- Tab T·ªïng quan -->
        <div id="overview" class="tab-content active">
            <h2>üéØ C√°c ph∆∞∆°ng ph√°p ki·ªÉm tra nhi·ªÅu t√†i kho·∫£n</h2>
            
            <div class="method-card">
                <h3>üîê 1. OAuth 2.0 - T·ª´ng ng∆∞·ªùi ƒëƒÉng nh·∫≠p</h3>
                <p>M·ªói ng∆∞·ªùi s·ªü h·ªØu t√†i kho·∫£n t·ª± ƒëƒÉng nh·∫≠p v√† c·∫•p quy·ªÅn</p>
                <div class="pros-cons">
                    <div class="pros">
                        <strong>‚úÖ ∆Øu ƒëi·ªÉm:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Ho√†n to√†n h·ª£p ph√°p v√† an to√†n</li>
                            <li>Tu√¢n th·ªß ch√≠nh s√°ch Google</li>
                            <li>Kh√¥ng c·∫ßn m·∫≠t kh·∫©u</li>
                            <li>Ng∆∞·ªùi d√πng ki·ªÉm so√°t quy·ªÅn truy c·∫≠p</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <strong>‚ùå Nh∆∞·ª£c ƒëi·ªÉm:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>C·∫ßn s·ª± tham gia c·ªßa t·ª´ng ng∆∞·ªùi</li>
                            <li>Kh√¥ng th·ªÉ t·ª± ƒë·ªông ho√†n to√†n</li>
                            <li>Token c√≥ th·ªÉ h·∫øt h·∫°n</li>
                        </ul>
                    </div>
                </div>
                <button class="btn btn-success" onclick="switchTab('accounts')">S·ª≠ d·ª•ng ph∆∞∆°ng ph√°p n√†y</button>
            </div>

            <div class="method-card">
                <h3>üè¢ 2. Google Workspace Admin</h3>
                <p>S·ª≠ d·ª•ng quy·ªÅn Admin ƒë·ªÉ truy c·∫≠p t·∫•t c·∫£ t√†i kho·∫£n trong t·ªï ch·ª©c</p>
                <div class="pros-cons">
                    <div class="pros">
                        <strong>‚úÖ ∆Øu ƒëi·ªÉm:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Truy c·∫≠p t·∫•t c·∫£ t√†i kho·∫£n doanh nghi·ªáp</li>
                            <li>T·ª± ƒë·ªông v√† nhanh ch√≥ng</li>
                            <li>B√°o c√°o t·ªïng h·ª£p</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <strong>‚ùå Nh∆∞·ª£c ƒëi·ªÉm:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Ch·ªâ cho Google Workspace</li>
                            <li>C·∫ßn quy·ªÅn Super Admin</li>
                            <li>Chi ph√≠ subscription</li>
                        </ul>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="showWorkspaceInfo()">T√¨m hi·ªÉu th√™m</button>
            </div>

            <div class="method-card">
                <h3>üìù 3. Google Apps Script</h3>
                <p>T·∫°o script ch·∫°y tr√™n Google's server ƒë·ªÉ ki·ªÉm tra multiple accounts</p>
                <div class="pros-cons">
                    <div class="pros">
                        <strong>‚úÖ ∆Øu ƒëi·ªÉm:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Ch·∫°y tr√™n server Google</li>
                            <li>Kh√¥ng gi·ªõi h·∫°n CORS</li>
                            <li>C√≥ th·ªÉ t·ª± ƒë·ªông h√≥a</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <strong>‚ùå Nh∆∞·ª£c ƒëi·ªÉm:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>C·∫ßn ki·∫øn th·ª©c l·∫≠p tr√¨nh</li>
                            <li>Gi·ªõi h·∫°n runtime</li>
                            <li>V·∫´n c·∫ßn OAuth cho t·ª´ng account</li>
                        </ul>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="showScriptInfo()">Xem code m·∫´u</button>
            </div>
        </div>

        <!-- Tab Thi·∫øt l·∫≠p -->
        <div id="setup" class="tab-content">
            <div class="setup-section">
                <h3>‚öôÔ∏è Thi·∫øt l·∫≠p OAuth 2.0 cho Multi-Account</h3>
                <div class="form-group">
                    <label for="clientId">Google OAuth Client ID:</label>
                    <input type="text" id="clientId" placeholder="Nh·∫≠p Client ID t·ª´ Google Cloud Console...">
                </div>
                
                <div class="warning">
                    <strong>üìã H∆∞·ªõng d·∫´n thi·∫øt l·∫≠p:</strong>
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        <li>Truy c·∫≠p Google Cloud Console</li>
                        <li>T·∫°o OAuth 2.0 Client ID</li>
                        <li>Th√™m domain v√†o authorized origins</li>
                        <li>B·∫≠t c√°c API c·∫ßn thi·∫øt: Drive, People, OAuth2</li>
                    </ol>
                </div>

                <button class="btn" onclick="initializeMultiAuth()">üîß Kh·ªüi t·∫°o Multi-Auth</button>
            </div>
        </div>

        <!-- Tab Qu·∫£n l√Ω t√†i kho·∫£n -->
        <div id="accounts" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üë• Qu·∫£n l√Ω t√†i kho·∫£n</h2>
                <button class="btn" onclick="addNewAccount()">‚ûï Th√™m t√†i kho·∫£n</button>
            </div>

            <div id="accountManager" class="account-manager">
                <!-- Accounts s·∫Ω ƒë∆∞·ª£c th√™m ƒë·ªông -->
            </div>

            <div style="margin: 30px 0;">
                <button class="btn btn-success" onclick="checkAllAccounts()">üîÑ Ki·ªÉm tra t·∫•t c·∫£</button>
                <button class="btn btn-secondary" onclick="exportResults()">üìä Xu·∫•t b√°o c√°o</button>
                <button class="btn btn-danger" onclick="clearAllAccounts()">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
            </div>
        </div>

        <!-- Tab K·∫øt qu·∫£ -->
        <div id="results" class="tab-content">
            <div id="summaryStats" style="display: none;"></div>
            <div id="resultsGrid" class="results-grid"></div>
        </div>

        <div id="messageArea"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gapi/2.0.2/gapi.min.js"></script>
    <script>
        let accounts = [];
        let currentAccountIndex = 0;
        let isInitialized = false;

        // Kh·ªüi t·∫°o
        function switchTab(tabName) {
            // ·∫®n t·∫•t c·∫£ tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Hi·ªán tab ƒë∆∞·ª£c ch·ªçn
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function initializeMultiAuth() {
            const clientId = document.getElementById('clientId').value.trim();
            
            if (!clientId) {
                showMessage('Vui l√≤ng nh·∫≠p Client ID tr∆∞·ªõc!', 'error');
                return;
            }

            window.gapi.load('auth2', () => {
                window.gapi.auth2.init({
                    client_id: clientId,
                    scope: 'https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile'
                }).then(() => {
                    isInitialized = true;
                    showMessage('‚úÖ Kh·ªüi t·∫°o th√†nh c√¥ng! B√¢y gi·ªù c√≥ th·ªÉ th√™m t√†i kho·∫£n.', 'success');
                }).catch(error => {
                    showMessage('‚ùå L·ªói kh·ªüi t·∫°o: ' + error.error, 'error');
                });
            });

            window.gapi.load('client', () => {
                window.gapi.client.init({
                    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                });
            });
        }

        function addNewAccount() {
            if (!isInitialized) {
                showMessage('Vui l√≤ng thi·∫øt l·∫≠p OAuth tr∆∞·ªõc!', 'error');
                switchTab('setup');
                return;
            }

            const accountId = 'account_' + Date.now();
            const newAccount = {
                id: accountId,
                email: '',
                name: '',
                avatar: '',
                status: 'disconnected',
                data: null,
                authInstance: null
            };

            accounts.push(newAccount);
            renderAccountManager();
        }

        function renderAccountManager() {
            const container = document.getElementById('accountManager');
            
            if (accounts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>Ch∆∞a c√≥ t√†i kho·∫£n n√†o</h3>
                        <p>Nh·∫•n "Th√™m t√†i kho·∫£n" ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = accounts.map(account => `
                <div class="account-item ${account.status}">
                    <div class="account-info">
                        <div class="account-avatar">
                            ${account.avatar ? `<img src="${account.avatar}" style="width: 100%; height: 100%; border-radius: 50%;">` : 'üë§'}
                        </div>
                        <div class="account-details">
                            <div class="account-email">${account.email || 'Ch∆∞a k·∫øt n·ªëi'}</div>
                            <div class="account-status">
                                ${account.status === 'connected' ? '‚úÖ ƒê√£ k·∫øt n·ªëi' : '‚ùå Ch∆∞a k·∫øt n·ªëi'}
                                ${account.name ? ` - ${account.name}` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="account-actions">
                        ${account.status === 'disconnected' ? 
                            `<button class="btn" onclick="connectAccount('${account.id}')">üîê K·∫øt n·ªëi</button>` :
                            `<button class="btn btn-secondary" onclick="disconnectAccount('${account.id}')">üö™ Ng·∫Øt k·∫øt n·ªëi</button>`
                        }
                        <button class="btn btn-danger" onclick="removeAccount('${account.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        async function connectAccount(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (!account) return;

            try {
                const authInstance = window.gapi.auth2.getAuthInstance();
                const user = await authInstance.signIn();
                
                const profile = user.getBasicProfile();
                account.email = profile.getEmail();
                account.name = profile.getName();
                account.avatar = profile.getImageUrl();
                account.status = 'connected';
                account.authInstance = user;

                renderAccountManager();
                showMessage(`‚úÖ ƒê√£ k·∫øt n·ªëi t√†i kho·∫£n ${account.email}`, 'success');
                
            } catch (error) {
                showMessage(`‚ùå L·ªói k·∫øt n·ªëi t√†i kho·∫£n: ${error.error || error.message}`, 'error');
            }
        }

        function disconnectAccount(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (!account) return;

            account.status = 'disconnected';
            account.email = '';
            account.name = '';
            account.avatar = '';
            account.data = null;
            account.authInstance = null;

            renderAccountManager();
            showMessage('ƒê√£ ng·∫Øt k·∫øt n·ªëi t√†i kho·∫£n', 'success');
        }

        function removeAccount(accountId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i kho·∫£n n√†y?')) {
                accounts = accounts.filter(a => a.id !== accountId);
                renderAccountManager();
                showMessage('ƒê√£ x√≥a t√†i kho·∫£n', 'success');
            }
        }

        function clearAllAccounts() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ t√†i kho·∫£n?')) {
                accounts = [];
                renderAccountManager();
                document.getElementById('resultsGrid').innerHTML = '';
                showMessage('ƒê√£ x√≥a t·∫•t c·∫£ t√†i kho·∫£n', 'success');
            }
        }

        async function checkAllAccounts() {
            const connectedAccounts = accounts.filter(a => a.status === 'connected');
            
            if (connectedAccounts.length === 0) {
                showMessage('Kh√¥ng c√≥ t√†i kho·∫£n n√†o ƒë∆∞·ª£c k·∫øt n·ªëi!', 'error');
                return;
            }

            switchTab('results');
            const resultsGrid = document.getElementById('resultsGrid');
            resultsGrid.innerHTML = '<div class="loading">üîÑ ƒêang ki·ªÉm tra t·∫•t c·∫£ t√†i kho·∫£n...</div>';

            let results = [];
            
            for (const account of connectedAccounts) {
                try {
                    // Gi·∫£ l·∫≠p vi·ªác ki·ªÉm tra Drive API
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // T·∫°o d·ªØ li·ªáu demo cho m·ªói t√†i kho·∫£n
                    const mockData = generateMockData(account.email);
                    account.data = mockData;
                    results.push(account);
                    
                } catch (error) {
                    console.error(`Error checking account ${account.email}:`, error);
                    account.data = { error: error.message };
                }
            }

            renderResults(results);
            renderSummaryStats(results);
        }

        function generateMockData(email) {
            const plans = [
                { name: 'Mi·ªÖn ph√≠ (15GB)', size: 15 * 1024 * 1024 * 1024 },
                { name: 'Google One (100GB)', size: 100 * 1024 * 1024 * 1024 },
                { name: 'Google One (200GB)', size: 200 * 1024 * 1024 * 1024 },
                { name: 'Google One (2TB)', size: 2 * 1024 * 1024 * 1024 * 1024 }
            ];
            
            const randomPlan = plans[Math.floor(Math.random() * plans.length)];
            const usedPercentage = 0.1 + Math.random() * 0.8;
            const totalUsed = randomPlan.size * usedPercentage;
            
            return {
                totalStorage: randomPlan.size,
                usedStorage: totalUsed,
                planType: randomPlan.name,
                driveUsage: totalUsed * (0.5 + Math.random() * 0.4),
                gmailUsage: totalUsed * (0.1 + Math.random() * 0.3),
                photosUsage: totalUsed * (0.05 + Math.random() * 0.2)
            };
        }

        function renderResults(results) {
            const resultsGrid = document.getElementById('resultsGrid');
            
            resultsGrid.innerHTML = results.map(account => {
                if (account.data.error) {
                    return `
                        <div class="storage-card">
                            <div class="card-header">
                                <img src="${account.avatar}" alt="Avatar" class="card-avatar">
                                <div class="card-info">
                                    <h3>${account.email}</h3>
                                    <p>‚ùå L·ªói: ${account.data.error}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }

                const data = account.data;
                const usagePercentage = ((data.usedStorage / data.totalStorage) * 100).toFixed(1);

                return `
                    <div class="storage-card">
                        <div class="card-header">
                            <img src="${account.avatar}" alt="Avatar" class="card-avatar">
                            <div class="card-info">
                                <h3>${account.email}</h3>
                                <p>${account.name} <span class="plan-badge">${data.planType}</span></p>
                            </div>
                        </div>

                        <div class="storage-grid">
                            <div class="storage-item">
                                <div class="storage-label">T·ªïng dung l∆∞·ª£ng</div>
                                <div class="storage-value">${formatBytes(data.totalStorage)}</div>
                            </div>
                            <div class="storage-item">
                                <div class="storage-label">ƒê√£ s·ª≠ d·ª•ng</div>
                                <div class="storage-value">${formatBytes(data.usedStorage)}</div>
                            </div>
                            <div class="storage-item">
                                <div class="storage-label">C√≤n l·∫°i</div>
                                <div class="storage-value">${formatBytes(data.totalStorage - data.usedStorage)}</div>
                            </div>
                            <div class="storage-item">
                                <div class="storage-label">% S·ª≠ d·ª•ng</div>
                                <div class="storage-value">${usagePercentage}%</div>
                            </div>
                        </div>

                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${usagePercentage}%"></div>
                        </div>

                        <div class="storage-grid">
                            <div class="storage-item">
                                <div class="storage-label">üìÅ Drive</div>
                                <div class="storage-value">${formatBytes(data.driveUsage)}</div>
                            </div>
                            <div class="storage-item">
                                <div class="storage-label">üìß Gmail</div>
                                <div class="storage-value">${formatBytes(data.gmailUsage)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderSummaryStats(results) {
            const validResults = results.filter(r => !r.data.error);
            const totalAccounts = validResults.length;
            const totalStorage = validResults.reduce((sum, r) => sum + r.data.totalStorage, 0);
            const totalUsed = validResults.reduce((sum, r) => sum + r.data.usedStorage, 0);
            const avgUsage = totalAccounts > 0 ? ((totalUsed / totalStorage) * 100).toFixed(1) : 0;

            const summaryStats = document.getElementById('summaryStats');
            summaryStats.style.display = 'block';
            summaryStats.innerHTML = `
                <div class="summary-stats">
                    <div class="summary-item">
                        <div class="summary-value">${totalAccounts}</div>
                        <div class="summary-label">T√†i kho·∫£n ƒë√£ ki·ªÉm tra</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${formatBytes(totalStorage)}</div>
                        <div class="summary-label">T·ªïng dung l∆∞·ª£ng</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${formatBytes(totalUsed)}</div>
                        <div class="summary-label">ƒê√£ s·ª≠ d·ª•ng</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${avgUsage}%</div>
                        <div class="summary-label">S·ª≠ d·ª•ng trung b√¨nh</div>
                    </div>
                </div>
            `;
        }

        function exportResults() {
            const connectedAccounts = accounts.filter(a => a.status === 'connected' && a.data && !a.data.error);
            
            if (connectedAccounts.length === 0) {
                showMessage('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!', 'error');
                return;
            }

            let csvContent = "Email,T√™n,G√≥i,T·ªïng dung l∆∞·ª£ng (GB),ƒê√£ s·ª≠ d·ª•ng (GB),C√≤n l·∫°i (GB),% S·ª≠ d·ª•ng,Drive (GB),Gmail (GB),Photos (GB)\n";
            
            connectedAccounts.forEach(account => {
                const data = account.data;
                const row = [
                    account.email,
                    account.name,
                    data.planType,
                    (data.totalStorage / (1024*1024*1024)).toFixed(2),
                    (data.usedStorage / (1024*1024*1024)).toFixed(2),
                    ((data.totalStorage - data.usedStorage) / (1024*1024*1024)).toFixed(2),
                    ((data.usedStorage / data.totalStorage) * 100).toFixed(1),
                    (data.driveUsage / (1024*1024*1024)).toFixed(2),
                    (data.gmailUsage / (1024*1024*1024)).toFixed(2),
                    (data.photosUsage / (1024*1024*1024)).toFixed(2)
                ].join(',');
                csvContent += row + "\n";
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `google_drive_report_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showMessage('‚úÖ ƒê√£ xu·∫•t b√°o c√°o CSV th√†nh c√¥ng!', 'success');
        }

        function showWorkspaceInfo() {
            showMessage(`
                <strong>üè¢ Google Workspace Admin API</strong><br><br>
                ƒê·ªÉ ki·ªÉm tra t·∫•t c·∫£ t√†i kho·∫£n trong t·ªï ch·ª©c:<br>
                ‚Ä¢ C·∫ßn quy·ªÅn Super Admin<br>
                ‚Ä¢ S·ª≠ d·ª•ng Reports API<br>
                ‚Ä¢ Domain-wide delegation<br>
                ‚Ä¢ Chi ph√≠: $6-18/user/th√°ng<br><br>
                üìñ T√†i li·ªáu: developers.google.com/admin-sdk
            `, 'info');
        }

        function showScriptInfo() {
            const scriptCode = `
function checkMultipleDrives() {
  // Google Apps Script code m·∫´u
  const emails = ['user1@domain.com', 'user2@domain.com'];
  const results = [];
  
  emails.forEach(email => {
    try {
      // Impersonate user (c·∫ßn domain-wide delegation)
      const oauth = ScriptApp.getOAuthToken();
      const response = UrlFetchApp.fetch(
        'https://www.googleapis.com/drive/v3/about?fields=storageQuota,user',
        {
          headers: {
            'Authorization': 'Bearer ' + oauth,
            'X-Goog-AuthUser': email
          }
        }
      );
      
      const data = JSON.parse(response.getContentText());
      results.push({
        email: email,
        quota: data.storageQuota,
        user: data.user
      });
      
    } catch (error) {
      console.error('Error for ' + email + ': ' + error.message);
    }
  });
  
  return results;
}
            `;
            
            showMessage(`
                <strong>üìù Google Apps Script Code M·∫´u</strong><br><br>
                <pre style="background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 8px; font-size: 12px; overflow-x: auto;">${scriptCode}</pre>
                <br>
                ‚ö†Ô∏è L∆∞u √Ω: C·∫ßn thi·∫øt l·∫≠p domain-wide delegation
            `, 'info');
        }

        // Utility functions
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showMessage(message, type = 'info') {
            const messageArea = document.getElementById('messageArea');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'info' ? 'warning' : 'warning';
            
            messageArea.innerHTML = `<div class="${className}">${message}</div>`;
            messageArea.scrollIntoView({ behavior: 'smooth' });
            
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, type === 'info' ? 10000 : 5000);
        }

        // Initialize
        window.addEventListener('load', function() {
            renderAccountManager();
            
            // Sample Client ID placeholder
            document.getElementById('clientId').placeholder = 'V√≠ d·ª•: 123456789-abc123def456ghi789jkl012mno345pqr678stu901.apps.googleusercontent.com';
        });
    </script>
</body>
</html>